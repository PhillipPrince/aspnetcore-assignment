@model Queue_Management_System.Models.QueueEntry

<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - Queue Management System</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/Queue_Management_System.styles.css" asp-append-version="true" />
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/jquery-validation/dist/jquery.validate.min.js"></script>
    <script src="~/lib/jquery-validation-unobtrusive/jquery.validate.unobtrusive.min.js"></script>

    <style>
        /* Style for large buttons */
        .kiosk-button {
            display: inline-block;
            width: 300px;
            height: 100px;
            margin: 10px;
            font-size: 24px;
            text-align: center;
            line-height: 100px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

            .kiosk-button:hover {
                background-color: #0056b3;
            }

        /* Vertical center alignment */
        .vertical-center {
            display: flex;
            flex-direction: column;
            justify-content: center;
            height: 100%;
        }

        /* CSS for the queue table */
        .queue-table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ddd;
        }

            .queue-table th, .queue-table td {
                padding: 8px;
                border: 1px solid #ddd;
                text-align: left;
            }

            .queue-table th {
                background-color: #f2f2f2;
            }

            .queue-table tbody tr:nth-child(even) {
                background-color: #f9f9f9;
            }

            .queue-table tbody tr:hover {
                background-color: #e2e2e2;
                cursor: pointer;
            }

    </style>
</head>
<body>
    <h1>Service Point Operations</h1>

    <div class="row">
        <!-- Column for buttons -->
        <div class="col-md-6">
           

            <div>
                
                <!-- Button for recalling a number -->
                <button type="button" class="kiosk-button" onclick="recallNumber()">Recall Number</button>
            </div>

            

            <div>
                
                <!-- Button for marking a number as finished -->
                <button type="button" class="kiosk-button" onclick="markAsFinished()">Mark as Finished</button>
            </div>

            <div>
                
                <!-- Button for transferring a number -->
                <button type="button" class="kiosk-button" onclick="transferNumber()">Transfer Number</button>
            </div>

            <div>
                
                <!-- Button to view the queue -->
                <button type="button" class="kiosk-button" onclick="viewQueue()">View Queue</button>
            </div>
        </div>

        <div class="col-md-6">
            <div class="current-number vertical-center">
                <h2>Ticket Details</h2>
                @if (Model != null)
                {
                    
                    <div id="ticketDetailsContainer">
                        <!-- Partial view content will be loaded here -->
                        @await Html.PartialAsync("_TicketDetailsPartial", Model)
                    </div>
                }
                else
                {
                    <p>No ticket details available.</p>
                }
            </div>
        </div>
    </div>

    <div id="queueEntriesContainer">
        <!-- Partial view content for queue entries will be loaded here -->
    </div>

    <script>
       

        function recallNumber() {
            var ticketNumber = "@Model?.TicketNumber";

            $.ajax({
                type: "POST",
                url: "/Queue/UpdateRecallCount",
                data: { ticketNumber: ticketNumber },
                success: function (data) {
                    $('#ticketDetailsContainer').html(data);
                },
                error: function () {
                    // Handle error if needed
                }
            });
        }




        function markAsFinished() {
            // Retrieve the ticket number from the Model on the page
            var ticketNumber = "@Model?.TicketNumber";

            // Make an AJAX POST request to mark the ticket as finished
            $.ajax({
                type: "POST",
                url: "/Queue/MarkFinished",
                data: { ticketNumber: ticketNumber }, // Send the ticket number as data
                success: function (data) {
                    // Update ticket details section with the received partial view
                    $('#ticketDetailsContainer').html(data);
                },
                error: function () {
                    // Handle error if needed
                }
            });
        }

        function transferNumber() {
            $.ajax({
                type: "GET",
                url: "/Queue/GetServiceProviders", // Endpoint to fetch the partial view
                success: function (data) {
                    // Update the container with the received partial view
                    $('#ticketDetailsContainer').html(data);
                },
                error: function () {
                    // Handle error if needed
                }
            });
        }

        function viewQueue() {
            $.ajax({
                type: "GET",
                url: "/Queue/GetQueueEntries", // Update with your endpoint and service point ID
                success: function (data) {
                    $('#queueEntriesContainer').html(data);
                },
                error: function () {
                    $('#queueEntriesContainer').html('<p>Failed to load queue entries.</p>');
                }
            });
        }
        
    </script>
</body>
</html>
